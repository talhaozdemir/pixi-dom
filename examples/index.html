<!DOCTYPE html>
<html>

<head>
  <title>PIXI DOM</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html,
    body {
      user-select: none;
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <script src="https://pixijs.download/dev/pixi.min.js"></script>
  <script src="../dist/pixi-dom.js"></script>
  <script type="module">
    const app = new PIXI.Application();
    await app.init({ resizeTo: window, preference: "webgl", backgroundColor: 0x2c3e50 });
    document.body.appendChild(app.canvas);

    const { stage, renderer } = app;

    const htmlCont = new PIXI.DOM.Container({
      debug: {
        enabled: true,
        color1: 0x92b7d1,
        color2: 0x2d86c4,
      },
      html: `
        <div class="grid">
            <div class="hud" style="grid-area: hud;">hud</div>
            <div class="game" style="grid-area: game;">game</div>
            <div class="ads" style="grid-area: ads;"></div>
        </div>`,
      css: `
        @media (orientation: portrait) {
          .grid {
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-areas: 
            "hud hud"
            "game game"
            "ads ads";
            grid-template-rows: 128px 1fr 64px;
            grid-template-columns: 1fr 6fr;
          } 
        }

        @media (orientation: landscape) {
          .grid {
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-areas: 
            "hud game"
            "hud game"
            "hud ads";
            grid-template-rows: 128px 1fr 48px;
            grid-template-columns: 2fr 6fr;
          } 
        }
        `,
    });
    stage.addChild(htmlCont);
    htmlCont.rootDiv.style.zIndex = -1;
    // console.log(htmlCont.children.map((child) => child.label));

    const gameArea = htmlCont.getElementByLabel("game");

    const bunnyTexture = await PIXI.Assets.load("https://pixijs.com/assets/bunny.png");

    const sprite = PIXI.Sprite.from(bunnyTexture);
    sprite.anchor.set(0.5);
    sprite.tint = 0xffffff;
    sprite.baseWidth = sprite.texture.orig.width;
    sprite.baseHeight = sprite.texture.orig.height;
    gameArea.addChild(sprite);

    sprite.resizeData = {
      portrait: {
        align: {
          x: "center",
          y: "center",
        },
        offset: {
          unit: "self",
          x: 0,
          y: 0,
        },
        scale: {
          type: "relative",
          fit: "min",
          x: 0.25,
          y: 0.25,
        },
      },
      landscape: {
        align: {
          x: "center",
          y: "center",
        },
        offset: {
          unit: "self",
          x: 0,
          y: 0,
        },
        scale: {
          type: "relative",
          fit: "min",
          x: 0.25,
          y: 0.25,
        },
      },
    };

    // sprite.resize = (w, h) => {
    //   const wRatio = (w * 0.5) / sprite.texture.orig.width;
    //   const hRatio = (h * 0.5) / sprite.texture.orig.height;
    //   sprite.scale.set(Math.min(wRatio, hRatio));

    //   sprite.x = w / 2;
    //   sprite.y = h / 2;
    // };

    //   let elapsed = 0.0;
    //   app.ticker.add((ticker) => {
    //     elapsed += ticker.deltaTime;
    //     sprite.angle = Math.cos(elapsed / 50.0) * 100.0;
    //   });

    new PIXI.DOM.Responsive(renderer, stage);
  </script>
</body>

</html>